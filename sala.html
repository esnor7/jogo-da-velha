<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Sala de Jogo da Velha</title>
</head>
<body>
  <h1>Sala de Jogo da Velha</h1>

  <!-- ENTRAR COM NOME -->
  <div id="inputNome">
    <p>Digite seu nome:</p>
    <input type="text" id="nomeJogador" placeholder="Seu nome">
    <button onclick="entrarSala()">Entrar</button>
  </div>

  <!-- SALA -->
  <div id="sala" style="display:none;">
    <div class="linha">
      <div class="slot" id="slot1" onclick="sentar(1)">Lugar 1</div>
      <div class="slot" id="slot2" onclick="sentar(2)">Lugar 2</div>
    </div>

    <div class="linha">
      <div class="slot" id="slot3" onclick="sentar(3)">Lugar 3</div>
      <div class="slot" id="slot4" onclick="sentar(4)">Lugar 4</div>
    </div>
  </div>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    firebase.initializeApp({
      apiKey: "AIzaSyAMPqH-lyB4X_whlGIW189rd5KVi2fM-IE",
      authDomain: "jogo-da-velha-online-36836.firebaseapp.com",
      databaseURL: "https://jogo-da-velha-online-36836-default-rtdb.firebaseio.com",
      projectId: "jogo-da-velha-online-36836"
    });

    const db = firebase.database();

    let usuario = localStorage.getItem("usuario"); // pega nome salvo
    let meuSlot = null;

    const pares = { 1:2, 2:1, 3:4, 4:3 };

    // se já tiver nome, vai direto para a sala
    if (usuario) {
      document.getElementById("inputNome").style.display = "none";
      document.getElementById("sala").style.display = "block";
    }

    function entrarSala() {
      const nome = document.getElementById("nomeJogador").value.trim();
      if (!nome) return alert("Digite seu nome!");

      usuario = nome;
      localStorage.setItem("usuario", usuario); // salva localmente
      document.getElementById("inputNome").style.display = "none";
      document.getElementById("sala").style.display = "block";
    }

    function sentar(id) {
      if (!usuario) return alert("Digite seu nome primeiro!");
      if (meuSlot) return alert("Você já está sentado!");

      const ref = db.ref("sala/slots/" + id);

      ref.once("value").then(snap => {
        if (snap.exists()) {
          alert("Lugar ocupado!");
        } else {
          ref.set(usuario);
          meuSlot = id;

          // remove se sair do site
          window.addEventListener("beforeunload", () => ref.remove());
        }
      });
    }

    db.ref("sala/slots").on("value", snap => {
      const dados = snap.val() || {};

      for (let i = 1; i <= 4; i++) {
        const el = document.getElementById("slot" + i);
        if (dados[i]) {
          el.textContent = dados[i];
          el.style.background = "#4CAF50";
        } else {
          el.textContent = "Lugar " + i;
          el.style.background = "#333";
        }
      }

      // inicia automático se o par completar
      if (meuSlot && dados[meuSlot] && dados[pares[meuSlot]]) {
        const j1 = dados[meuSlot];
        const j2 = dados[pares[meuSlot]];
        const jogoId = `${j1}_vs_${j2}`.replace(/\s/g, "_");
        window.location.href = `jogo.html?j1=${encodeURIComponent(j1)}&j2=${encodeURIComponent(j2)}&id=${jogoId}`;
      }
    });
  </script>

  <style>
    body { background:#111; color:#fff; text-align:center; font-family:Arial }
    .linha { display:flex; justify-content:center }
    .slot {
      width:120px; height:80px; margin:10px;
      background:#333; display:flex;
      justify-content:center; align-items:center;
      cursor:pointer; border-radius:8px;
      font-weight:bold;
    }
    .slot:hover { background:#555 }
  </style>
</body>
</html>
