<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Sala de Jogo da Velha</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">
</head>
<body>
  <h1>Sala de Jogo da Velha</h1>

  <!-- ENTRAR COM NOME -->
  <div id="inputNome">
    <p>Digite seu nome:</p>
    <input type="text" id="nomeJogador" placeholder="Ex: Anônimo123">
    <button id="btnEntrar" onclick="entrarSala()">Entrar</button>

    <!-- Rodapé do desenvolvedor na tela de entrada -->
    <p id="rodapeEntrada">
      Site desenvolvido por 
      <a href="https://www.instagram.com/dpzyn_?igsh=MTJ4dWlsczl2aHdhaw==" target="_blank">Davi</a>
    </p>
  </div>

  <!-- SALA -->
  <div id="sala" style="display:none;">
    <p id="statusSala">Aguardando jogadores...</p>

    <div class="linha">
      <div class="slot" id="slot1" onclick="sentar(1)">Lugar 1</div>
      <div class="slot" id="slot2" onclick="sentar(2)">Lugar 2</div>
    </div>

    <div class="linha">
      <div class="slot" id="slot3" onclick="sentar(3)">Lugar 3</div>
      <div class="slot" id="slot4" onclick="sentar(4)">Lugar 4</div>
    </div>

    <!-- Rodapé do desenvolvedor na sala -->
    <p id="rodapeSala">
      Site desenvolvido por 
      <a href="https://www.instagram.com/dpzyn_?igsh=MTJ4dWlsczl2aHdhaw==" target="_blank">Davi</a>
    </p>
  </div>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    firebase.initializeApp({
      apiKey: "AIzaSyAMPqH-lyB4X_whlGIW189rd5KVi2fM-IE",
      authDomain: "jogo-da-velha-online-36836.firebaseapp.com",
      databaseURL: "https://jogo-da-velha-online-36836-default-rtdb.firebaseio.com",
      projectId: "jogo-da-velha-online-36836"
    });

    const db = firebase.database();
    let usuario = localStorage.getItem("usuario") || "";
    let meuSlot = null;
    const pares = { 1:2, 2:1, 3:4, 4:3 };

    if (usuario) entrarSala();

    function entrarSala() {
      if (!usuario) {
        const nome = document.getElementById("nomeJogador").value.trim();
        if (!nome) return alert("Digite seu nome!");
        usuario = nome;
        localStorage.setItem("usuario", usuario);
      }
      document.getElementById("inputNome").style.display = "none";
      document.getElementById("sala").style.display = "block";
    }

    function sentar(id) {
      if (!usuario) return alert("Digite seu nome primeiro!");
      if (meuSlot) return alert("Você já está sentado!");

      const ref = db.ref("sala/slots/" + id);
      ref.once("value").then(snap => {
        if (snap.exists() && snap.val() !== null) {
          alert("Lugar ocupado!");
        } else {
          ref.set(usuario);
          meuSlot = id;
          window.addEventListener("beforeunload", () => ref.remove());
        }
      });
    }

    db.ref("sala/slots").on("value", snap => {
      const dados = snap.val() || {};
      for (let i = 1; i <= 4; i++) {
        const el = document.getElementById("slot" + i);
        if (dados[i]) {
          el.textContent = dados[i];
          el.classList.add("ocupado");
        } else {
          el.textContent = "Lugar " + i;
          el.classList.remove("ocupado");
        }
      }

      const status = document.getElementById("statusSala");
      if (meuSlot && dados[meuSlot] && dados[pares[meuSlot]]) {
        const j1 = dados[meuSlot];
        const j2 = dados[pares[meuSlot]];
        const jogoId = `${j1}_vs_${j2}`.replace(/\s/g, "_");
        window.location.href = `jogo.html?j1=${encodeURIComponent(j1)}&j2=${encodeURIComponent(j2)}&id=${jogoId}&t=${Date.now()}`;
      } else {
        status.textContent = "Aguardando outro jogador...";
      }
    });
  </script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(-45deg,#111,#222,#333,#444);
      background-size: 400% 400%;
      animation: grad 15s ease infinite;
      color: #fff;
      text-align: center;
      min-height: 100vh;
      position: relative;
    }

    @keyframes grad {
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }

    h1 { margin-bottom: 20px; }

    #inputNome input {
      padding: 10px; font-size: 16px; border-radius: 8px; border:none;
    }
    #btnEntrar {
      padding: 10px 20px; font-size:16px; border:none; border-radius:8px;
      cursor:pointer; background:#ff9800; color:#fff;
      font-weight:bold; transition: all 0.3s;
    }
    #btnEntrar:hover { background:#e68a00; transform: scale(1.05); }

    .linha { display:flex; justify-content:center; margin-top:20px; }
    .slot {
      width:140px; height:100px; margin:10px;
      background:#333; display:flex;
      justify-content:center; align-items:center;
      cursor:pointer; border-radius:12px;
      font-weight:bold; font-size:18px;
      transition: all 0.3s;
      box-shadow: 0 0 5px #000;
    }
    .slot:hover { transform: scale(1.05); box-shadow: 0 0 20px #fff; }
    .ocupado { background:#4CAF50; box-shadow:0 0 20px #4CAF50; }
    #statusSala { margin-top:20px; font-size:18px; font-weight:bold; }

    /* Rodapé */
    #rodapeEntrada, #rodapeSala {
      position: fixed;
      bottom: 5px;
      width: 100%;
      text-align: center;
      font-size: 14px;
      color: #ccc;
    }
    #rodapeEntrada a, #rodapeSala a {
      color: #ff9800;
      text-decoration: none;
      font-weight: bold;
    }
    #rodapeEntrada a:hover, #rodapeSala a:hover {
      text-decoration: underline;
    }
  </style>
</body>
  </html>
