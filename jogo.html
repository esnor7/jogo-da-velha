<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Jogo da Velha Online</title>
</head>
<body>

<h2 id="info"></h2>

<div class="tabuleiro">
  <div class="casa" onclick="jogar(0)"></div>
  <div class="casa" onclick="jogar(1)"></div>
  <div class="casa" onclick="jogar(2)"></div>

  <div class="casa" onclick="jogar(3)"></div>
  <div class="casa" onclick="jogar(4)"></div>
  <div class="casa" onclick="jogar(5)"></div>

  <div class="casa" onclick="jogar(6)"></div>
  <div class="casa" onclick="jogar(7)"></div>
  <div class="casa" onclick="jogar(8)"></div>
</div>

<button onclick="resetar()">Reiniciar</button>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAMPqH-lyB4X_whlGIW189rd5KVi2fM-IE",
    authDomain: "jogo-da-velha-online-36836.firebaseapp.com",
    databaseURL: "https://jogo-da-velha-online-36836-default-rtdb.firebaseio.com",
    projectId: "jogo-da-velha-online-36836",
    storageBucket: "jogo-da-velha-online-36836.appspot.com",
    messagingSenderId: "1067127105922",
    appId: "1:1067127105922:web:18a6a4f194711d4973479b"
  };

  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }

  const db = firebase.database();
</script>

<script>
  const params = new URLSearchParams(window.location.search);
  const j1 = params.get("j1");
  const j2 = params.get("j2");

  const jogoRef = db.ref("jogoAtual");

  const info = document.getElementById("info");
  const casas = document.querySelectorAll(".casa");

  const vitorias = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];

  jogoRef.once("value").then(snap => {
    if (!snap.exists()) {
      jogoRef.set({
        tabuleiro: ["","","","","","","","",""],
        turno: "X",
        ativo: true
      });
    }
  });

  function jogar(pos) {
    jogoRef.once("value").then(snap => {
      const dados = snap.val();
      if (!dados.ativo) return;
      if (dados.tabuleiro[pos] !== "") return;

      dados.tabuleiro[pos] = dados.turno;
      dados.turno = dados.turno === "X" ? "O" : "X";

      jogoRef.set(dados);
    });
  }

  jogoRef.on("value", snap => {
    const dados = snap.val();
    if (!dados) return;

    casas.forEach((casa, i) => {
      casa.textContent = dados.tabuleiro[i];
    });

    info.textContent = `Vez de: ${dados.turno === "X" ? j1 : j2}`;

    verificarFim(dados);
  });

  function verificarFim(dados) {
    for (let combo of vitorias) {
      const [a,b,c] = combo;
      if (
        dados.tabuleiro[a] &&
        dados.tabuleiro[a] === dados.tabuleiro[b] &&
        dados.tabuleiro[a] === dados.tabuleiro[c]
      ) {
        info.textContent = `üèÜ Vencedor: ${dados.tabuleiro[a] === "X" ? j1 : j2}`;
        jogoRef.update({ ativo: false });
        return;
      }
    }

    if (!dados.tabuleiro.includes("")) {
      info.textContent = "ü§ù Empate!";
      jogoRef.update({ ativo: false });
    }
  }

  function resetar() {
    jogoRef.set({
      tabuleiro: ["","","","","","","","",""],
      turno: "X",
      ativo: true
    });
  }
</script>

<style>
  body {
    background: #111;
    color: #fff;
    text-align: center;
    font-family: Arial;
  }

  .tabuleiro {
    display: grid;
    grid-template-columns: repeat(3, 100px);
    gap: 10px;
    justify-content: center;
    margin: 20px auto;
  }

  .casa {
    width: 100px;
    height: 100px;
    background: #333;
    font-size: 50px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    border-radius: 8px;
  }

  .casa:hover {
    background: #555;
  }

  button {
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: #ff9800;
    color: #fff;
  }
</style>

</body>
</html>
