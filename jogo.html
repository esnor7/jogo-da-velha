<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Jogo da Velha Online</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">
</head>
<body>

<h2 id="info"></h2>

<div class="tabuleiro">
  <div class="casa" onclick="jogar(0)"></div>
  <div class="casa" onclick="jogar(1)"></div>
  <div class="casa" onclick="jogar(2)"></div>

  <div class="casa" onclick="jogar(3)"></div>
  <div class="casa" onclick="jogar(4)"></div>
  <div class="casa" onclick="jogar(5)"></div>

  <div class="casa" onclick="jogar(6)"></div>
  <div class="casa" onclick="jogar(7)"></div>
  <div class="casa" onclick="jogar(8)"></div>
</div>

<button onclick="resetar()">Reiniciar</button>

<p id="rodapeJogo">
  Site desenvolvido por 
  <a href="https://www.instagram.com/dpzyn_?igsh=MTJ4dWlsczl2aHdhaw==" target="_blank">Davi</a>
</p>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyAMPqH-lyB4X_whlGIW189rd5KVi2fM-IE",
  authDomain: "jogo-da-velha-online-36836.firebaseapp.com",
  databaseURL: "https://jogo-da-velha-online-36836-default-rtdb.firebaseio.com",
  projectId: "jogo-da-velha-online-36836"
});

const db = firebase.database();
</script>

<script>
// Pega usu√°rio e jogoId do sessionStorage
const usuario = sessionStorage.getItem("usuario");
const jogoId = sessionStorage.getItem("jogoId");

if(!usuario || !jogoId){
  alert("Voc√™ n√£o est√° em uma partida! Voltando √† p√°gina inicial.");
  window.location.href = "index.html";
}

const jogoRef = db.ref("jogos/" + jogoId);

const info = document.getElementById("info");
const casas = document.querySelectorAll(".casa");

let meuSimbolo = "";

jogoRef.once("value").then(snap => {
  const dados = snap.val();
  if(!dados) return;

  if(usuario === dados.j1) meuSimbolo = "X";
  else if(usuario === dados.j2) meuSimbolo = "O";
  else {
    alert("Voc√™ n√£o est√° nessa partida!");
    window.location.href = "index.html";
  }

  // Cria partida se n√£o existir
  if(!snap.exists()){
    jogoRef.set({
      tabuleiro:["","","","","","","","",""],
      turno:"X",
      ativo:true,
      j1:dados.j1,
      j2:dados.j2
    });
  }
});

const vitorias = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];

function jogar(pos){
  jogoRef.once("value").then(snap=>{
    const dados = snap.val();
    if(!dados || !dados.ativo) return;
    if(dados.turno !== meuSimbolo) return;
    if(dados.tabuleiro[pos] !== "") return;

    dados.tabuleiro[pos] = meuSimbolo;
    dados.turno = meuSimbolo === "X" ? "O" : "X";

    jogoRef.set(dados);
  });
}

jogoRef.on("value", snap=>{
  const dados = snap.val();
  if(!dados) return;

  casas.forEach((casa,i)=> casa.textContent = dados.tabuleiro[i]);

  if(dados.ativo){
    info.textContent = `Vez de ${dados.turno === "X" ? dados.j1 : dados.j2}`;
  }

  verificarFim(dados);
});

function verificarFim(dados){
  for(let [a,b,c] of vitorias){
    if(dados.tabuleiro[a] && dados.tabuleiro[a] === dados.tabuleiro[b] && dados.tabuleiro[a] === dados.tabuleiro[c]){
      info.textContent = `üèÜ Vencedor: ${dados.tabuleiro[a]==="X"?dados.j1:dados.j2}`;
      jogoRef.update({ativo:false});
      return;
    }
  }

  if(!dados.tabuleiro.includes("")){
    info.textContent = "ü§ù Empate!";
    jogoRef.update({ativo:false});
  }
}

function resetar(){
  jogoRef.set({
    tabuleiro:["","","","","","","","",""],
    turno:"X",
    ativo:true,
    j1: jogoId.split("_vs_")[0],
    j2: jogoId.split("_vs_")[1]
  });
}
</script>

<style>
body {
  background:#111;
  color:#fff;
  text-align:center;
  font-family:'Poppins',sans-serif;
  padding:20px;
}

.tabuleiro{
  display:grid;
  grid-template-columns:repeat(3,100px);
  gap:10px;
  justify-content:center;
  margin:20px auto;
}

.casa{
  width:100px;
  height:100px;
  background:#333;
  font-size:50px;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
  border-radius:8px;
}

.casa:hover{background:#555}

button{
  padding:10px 20px;
  font-size:16px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  background:#888; /* cinza neutro */
  color:#fff;
  margin-top:20px;
}

#rodapeJogo{
  margin-top:30px;
  font-size:14px;
  color:#ccc;
}
#rodapeJogo a{
  color:#1E90FF;
  text-decoration:none;
  font-weight:bold;
}
#rodapeJogo a:hover{
  text-decoration:underline;
}
</style>
</body>
</html>
